ProdMind CLI v0.1 → v0.2 改动需求（仅需求，不含实现）
0. 背景

当前对话流程已能触发“替代假设阻断”和“强制回应”，但存在：

用户可用“AI加速开发”绕开核心质疑（技术逃逸）

用户鬼输出出现重复、冗长，信息密度下降

落地者在产出阶段遇到 API 错误会导致资产丢失

1) 新增：技术逃逸拦截（P0）
1.1 触发条件（任一满足则触发）

当用户在“必须回应质疑”阶段或冲突阶段的回应文本中出现以下任意模式：

强调“AI/大模型能显著缩短周期/提升质量/成本趋近于零”

强调“不能用传统方式评估开发时间/我们开发很快”

回答重点明显转移到“实现能力/开发速度”，而非“需求真实性/价值/风险/迁移”

（可用关键词 + 简单语义规则实现）

1.2 系统行为

触发后，系统必须插入一个不可跳过的补充追问（不进入下一角色）：

追问必须同时覆盖：

即使开发成本≈0，用户是否买单/是否迁移？

风险归属如何转移？谁背锅？

最小验证动作是什么？

用户必须回答（≥50字）才能继续流程。

1.3 验收标准

当用户以“AI很强/开发很快”作为主要回应理由时，系统必定打断并追问上述三点；

未回答无法进入落地者阶段或下一轮。

2) 新增：用户鬼输出去重与限长（P0）
2.1 角色输出规范（系统级约束）

对“用户鬼”角色增加硬约束：

每个 section（我为什么不会用 / 替代方案 / 如果这是错的）最多 5 条 bullet

输出总长度上限（建议 350–600 中文字区间，具体你定）

禁止重复：同一段内不得出现语义重复句；若重复则必须合并或删减

2.2 系统行为（运行时拦截）

在用户鬼输出后，系统执行“重复检测”：

若检测到明显重复段落（相同句或高相似句），则：

自动要求用户鬼“自检重写一次”（同角色重试一次）

第二次仍重复，则强制截断并保留信息密度最高的部分（按 section 保留前N条）

2.3 验收标准

用户鬼输出不再出现重复段落大段粘贴；

每个 section 结构保持完整且不超过限定条数；

信息密度提升：同轮输出可在 30 秒内读完并提取要点。

3) 新增：落地者产出失败的“资产兜底”机制（P0）
3.1 触发条件

当落地者调用模型失败（如网络错误、Premature close、超时、5xx、解析失败等）：

3.2 系统行为（两级兜底）

第一级：自动重试与切换

自动重试 1 次（同 provider）

若失败，切换到备用 provider / 备用模型（按你的配置优先级）再试 1 次

若仍失败，进入第二级兜底

第二级：本地规则降级生成（不调用LLM）
CLI 必须仍然输出一个“最小可用的落地者结果”，包含以下四块（保持你 v0.2 模板）：

当前最强假设（≤2条）

MVP边界（包含/排除/一周内范围）

未决冲突（≥1条：冲突/争议点/证伪动作）

下一步行动（1–3条：动作/验证对象/截止）

该降级输出允许较粗糙，但必须保证：

可读

可复制

可作为下一轮输入继续对话

3.3 验收标准

即使落地者 API 失败，本轮会话仍然产出完整“残骸资产”，不会出现“空缺/断档”；

产物可直接保存为 markdown，且结构字段齐全。

4) 优化：冲突闭环完成条件（P1，建议做）
4.1 闭环判定

在允许进入“落地者”之前，系统必须确认：

所有“替代假设标签”都已被用户处理为：

承认 / 提供反证 / 标记待验证（三选一）

若存在未处理替代假设，则强制用户先处理

4.2 验收标准

不存在“刺客提出替代假设但用户未归档处理就直接总结”的情况。

5) 可观测性（P1，但强烈建议）

每轮结束输出一个简短的“诊断行”（给你调试用）：

替代假设标签：X

是否触发技术逃逸：Y/N

是否触发共识警报：Y/N

是否发生兜底：none / retry / fallback